<template>
    <div class="page light" data-name="absen">
        <div class="navbar no-shadow">
            <div class="navbar-inner sliding">
                <div class="navbar-bg"></div>
                <div class="left">
                    <a href="#" class="link back">
                        <i class="material-icons">navigate_before</i>
                    </a>
                </div>
                <div class="title" style="margin-left: -10px;">Absensi</div>
                <div class="right">
                    <a href="/school/absen-harian/" class="link icon-only">
                        <i class="material-icons">event</i>
                    </a>
                    <a href="#" class="link popover-open" data-popover=".popover-akun">
                        <figure class="avatar avatar-30 border-0"><img src="img/profil1.png" alt=""></figure>
                    </a>
                    <a href="#" class="link icon-only popover-open" data-popover=".popover-menu">
                        <i class="material-icons ">more_vert</i>
                    </a>
                </div>
            </div>
        </div>
        <div class="page-content" style="overflow-x: hidden;">
            <div class="block no-padding mt-0">
                <div class="card">
                    <div class="toolbar absen-bulananCard-toolbar no-shadow">
                        <div class="toolbar-inner">
                            <div class="left">
                                <a href="#" class="link icon-only"><i class="icon icon-back color-black"></i></a>
                            </div>
                            <div class="center"></div>
                            <div class="right">
                                <a href="#" class="link icon-only"><i class="icon icon-forward color-black"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            <div class="block px-2 mt-0">
                <div class="list media-list medium-inset no-margin no-hairlines no-safe-area-left">
                <ul id="ul-bulananCard">
                </ul>
                </div>
            </div>
            </div>
        </div>
        <div class="popover popover-akun popover-on-right">
            <div class="popover-angle"></div>
            <div class="popover-inner">
            <div class="list">
                <ul>
                    <li>
                        <div class="item-content">
                            <div class="item-media">
                                <div class="avatar avatar-40 no-shadow border-0">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/d/d3/Foto_Formal_Sudharmono.jpg" alt="">
                                </div>
                            </div>
                            <div class="item-inner">
                                <div class="item-title">Deni Yudi<br><span class="text-secondary small mt-0">X OTO - Smk Brantas</span></div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-media">
                                <div class="avatar avatar-40 no-shadow border-0">
                                    <img src="https://1.bp.blogspot.com/-xkSQiVSWVss/WAYh7HS4B4I/AAAAAAAAAKA/cJUtlh3kcSErmHAwW0GLU_6q5NP5wVLegCLcB/s1600/photo%2Bclose%2Bup.jpg" alt="">
                                </div>
                            </div>
                            <div class="item-inner">
                                <div class="item-title">Sasi Kanti<br><span class="text-secondary small mt-0">X TKI - Smk Brantas</span></div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-media">
                                <div class="avatar avatar-40 no-shadow border-0">
                                    <img src="https://bkpsdmd.babelprov.go.id/sites/default/files/images/artikel/1_7.png" alt="">
                                </div>
                            </div>
                            <div class="item-inner">
                                <div class="item-title">Erik Setiadi<br><span class="text-secondary small mt-0">X TKI - Smk Telkom</span></div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-media">
                                <div class="avatar avatar-40 no-shadow border-0">
                                    <div class="overlay bg-color-gray"></div>
                                    <i class="material-icons text-color-white">person_add</i>
                                </div>
                            </div>
                            <div class="item-inner">
                                <div class="item-title">Tambah Akun</div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            </div>
        </div>
        <div class="popover popover-menu popover-on-right" style="width: 100px;">
            <div class="popover-angle"></div>
                <div class="popover-inner">
                    <div class="list">
                        <ul>
                            <li>
                                <a href="/school/bantuan/" class="item-content item-link no-chevron popover-close">
                                    <div class="item-inner">
                                    <div class="item-title text-color-black">Bantuan</span></div>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
        </div>
    </div>
    <div class="popup demo-popup-swipe">
        <div class="page light">
            <div class="navbar">
                <div class="navbar-bg"></div>
                <div class="navbar-inner">
                    <div class="title">Swipe To Close</div>
                    <div class="right"><a href="#" class="link popup-close">Close</a></div>
                </div>
            </div>
            <div class="page-content">
                <div style="height: 100%" class="display-flex justify-content-center align-items-center">
                <p>Swipe me up or down</p>
                </div>
            </div>
        </div>
    </div>
</template>
<script>
    var data = new Date();
    var year = data.getFullYear();
    var month = data.getMonth();
    var day = data.getDay();
    var monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus' , 'September' , 'Oktober', 'November', 'Desember'];
    var absenHarian=[
        {
        date: new Date(year, month, day),
        hours: 07,
        minutes: 30,
        title: 'Masuk Sekolah',
        masuk:18,
        ijin:1,
        sakit:2,
        alpa:2,
        },
        {
        date: new Date(year, month, day),
        hours: 09,
        minutes: 0,
        title: 'Matematika',
        masuk:10,
        ijin:5,
        sakit:1,
        alpa:2,
        },
        {
        date: new Date(year, month, day),
        hours: 10,
        minutes: 0,
        title: 'Sejarah',
        masuk:18,
        ijin:1,
        sakit:2,
        alpa:2,
        },
        {
        date: new Date(year, month, day),
        hours: 11,
        minutes: 0,
        title: 'Bahasa Indonesia',
        masuk:12,
        ijin:5,
        sakit:2,
        alpa:3,
        },
        {
        date: new Date(year, month, day),
        hours: 11,
        minutes: 0,
        title: 'Bahasa Inggris',
        masuk:12,
        ijin:5,
        sakit:2,
        alpa:3,
        },
        {
        date: new Date(year, month, day),
        hours: 11,
        minutes: 0,
        title: 'Fisika',
        masuk:12,
        ijin:5,
        sakit:2,
        alpa:3,
        },
        {
        date: new Date(year, month, day),
        hours: 11,
        minutes: 0,
        title: 'Kimia',
        masuk:12,
        ijin:5,
        sakit:2,
        alpa:3,
        },
        {
        date: new Date(year, month, day),
        hours: 12,
        minutes: 0,
        title: 'Pulang',
        masuk:18,
        ijin:1,
        sakit:2,
        alpa:2,
        },
        {
        date: new Date(year, month-1, day - 2),
        hours: 07,
        minutes: 0,
        title: 'Masuk Sekolah',
        masuk:15,
        ijin:3,
        sakit:2,
        alpa:2,
        },
        {
        date: new Date(year, month-1, day - 2),
        hours: 10,
        minutes: 20,
        title: 'Bahasa Inggris',
        masuk:15,
        ijin:3,
        sakit:2,
        alpa:2,
        },
        {
        date: new Date(year, month-1, day - 2),
        hours: 11,
        minutes: 0,
        title: 'Fisika',
        masuk:15,
        ijin:3,
        sakit:2,
        alpa:2,
        },
        {
        date: new Date(year, month-1, day - 2),
        hours: 12,
        minutes: 45,
        title: 'Pulang',
        masuk:15,
        ijin:3,
        sakit:2,
        alpa:2,
        },
    ];
    function renderEvents() {
        var currentDate = data;
        var currentEvents = absenHarian
        .filter(function (event) {
            return (
                event.date.getMonth() === currentDate.getMonth() && event.date.getFullYear() === currentDate.getFullYear()
            );
        });
        document.getElementById("ul-bulananCard").innerHTML = "";
        const eventItems = [];
        if (currentEvents.length) {
        currentEvents.forEach(function (event) {
            const hours = event.hours;
            let minutes = event.minutes;
            if (minutes < 10) minutes = `0${minutes}`;
            eventItems.push({
                title: event.title,
                time: `${hours}:${minutes}`,
                masuk:event.masuk,
                ijin:event.ijin,
                sakit:event.sakit,
                alpa:event.alpa,
            });
        });
        eventItems.forEach(function (a) {
            document.getElementById("ul-bulananCard").innerHTML += 
            '<li class="card">'+
                        '<div class="card-content">'+
                            '<div class="item-content">'+
                                '<div class="item-inner">'+
                                    '<div class="item-title-row">'+
                                        '<div class="item-title" style="top: -5px;">'+a.title+'</div>'+
                                    '</div>'+
                                    '<div class="item-subtitle">'+
                                        '<div class="row">'+
                                            '<a href="/school/absen/masuk/" id="masuk" class="col" >'+
                                                '<div class="chip" style="height: 20px;">'+
                                                    '<div class="chip-media bg-color-green small" style="height: 20px; width: 20px;">'+
                                                        '<i class="material-icons text-color-white small">check</i>'+
                                                    '</div>'+
                                                    '<div class="chip-label">'+a.masuk+'</div>'+
                                                '</div>'+
                                            '</a>'+
                                            '<a href="/school/absen/sakit/" id="sakit" class="col">'+
                                                '<div class="chip" style="height: 20px;">'+
                                                    '<div class="chip-media bg-color-orange small" style="height: 20px; width: 20px;">'+
                                                        'S'+
                                                    '</div>'+
                                                    '<div class="chip-label">'+a.sakit+'</div>'+
                                                '</div>'+
                                            '</a>'+
                                            '<a href="/school/absen/ijin/" id="ijin" class="col">'+
                                                '<div class="chip" style="height: 20px;">'+
                                                    '<div class="chip-media bg-color-gray small" style="height: 20px; width: 20px;">'+
                                                        'I'+
                                                    '</div>'+
                                                    '<div class="chip-label">'+a.ijin+'</div>'+
                                                '</div>'+
                                            '</a>'+
                                            '<a href="/school/absen/alpa/" id="alpa" class="col">'+
                                                '<div class="chip" style="height: 20px;">'+
                                                    '<div class="chip-media bg-color-red small" style="height: 20px; width: 20px;">'+
                                                        'A'+
                                                    '</div>'+
                                                    '<div class="chip-label">'+a.alpa+'</div>'+
                                                '</div>'+
                                            '</a>'+
                                        '</div>'+
                                    '</div>'+
                                '</div>'+
                            '</div>'+
                        '</div>'+
                    '</li>'
        });
    }else{
        document.getElementById("ul-bulananCard").innerHTML = '<li class="item-content">'+
                '<div class="item-inner">'+
                    '<div class="item-title text-color-gray">Tidak ada Absensi</div>'+
                '</div>'+
            '</li>';
    }
    };
    return {
        on: {
        pageInit: function (e, page) {
            var self = this;
            var app = self.$app;
            var $ = self.$;
            localStorage.setItem('bantuanValue', 'menuabsensi');
            renderEvents();
            $('.absen-bulananCard-toolbar .center').text(monthNames[data.getMonth()]+' '+data.getFullYear());
            $('.absen-bulananCard-toolbar .left .link').on('click', function () {
                data.setMonth(data.getMonth()-1);
                $('.absen-bulananCard-toolbar .center').text(monthNames[data.getMonth()]+' '+data.getFullYear());
                renderEvents();
            });
            $('.absen-bulananCard-toolbar .right .link').on('click', function () {
                data.setMonth(data.getMonth()+1);
                $('.absen-bulananCard-toolbar .center').text(monthNames[data.getMonth()]+' '+data.getFullYear());
                renderEvents();
            });
        },
        pageBeforeRemove() {
            var self=this;
            if (self.popupSwipe) self.popupSwipe.destroy();
            data= new Date();
            localStorage.removeItem('bantuanValue');
        },
    }
    }
</script>

<!-- <li>
    <div class="item-content">
      <div class="item-media">
        <div class="col text-align-center">
            <h6 class="font-weight-normal mb-0 mt-1" style="color: gray;">05</h6>
            <p class="text-mute medium text-secondary mt-1" style="color: gray;">Okt</p>
        </div>
      </div>
      <div class="item-inner">
        <div class="item-title" style="font-weight: 500; font-size: 20px; color: gray;">Kerjaan</div>
        <div class="item-after"><strong>07:30 - 16:45</strong></div>
      </div>
    </div>
  </li>
  <li>
    <div class="item-content">
      <div class="item-media">
        <div class="col text-align-center">
            <h6 class="font-weight-normal mb-0 mt-1">06</h6>
            <p class="text-mute medium text-secondary mt-1">Okt</p>
        </div>
      </div>
      <div class="item-inner">
        <div class="item-title" style="font-weight: 500; font-size: 20px;">Kerjaan</div>
        <div class="item-after"><strong>07:30 - 16:45</strong></div>
      </div>
    </div>
  </li>
  <li>
    <div class="item-content">
      <div class="item-media">
        <div class="col text-align-center">
            <h6 class="font-weight-normal mb-0 mt-1">07</h6>
            <p class="text-mute medium text-secondary mt-1">Okt</p>
        </div>
      </div>
      <div class="item-inner">
        <div class="item-title" style="font-weight: 500; font-size: 20px;">Kerjaan</div>
        <div class="item-after"><strong>07:30 - 16:45</strong></div>
      </div>
    </div>
  </li>
  <li>
    <div class="item-content">
      <div class="item-media">
        <div class="col text-align-center">
            <h6 class="font-weight-normal mb-0 mt-1">08</h6>
            <p class="text-mute medium text-secondary mt-1">Okt</p>
        </div>
      </div>
      <div class="item-inner">
        <div class="item-title" style="font-weight: 500; font-size: 20px;">Kerjaan</div>
        <div class="item-after"><strong>07:30 - 16:45</strong></div>
      </div>
    </div>
  </li>
  <li>
    <div class="item-content">
      <div class="item-media">
        <div class="col text-align-center">
            <h6 class="font-weight-normal mb-0 mt-1">09</h6>
            <p class="text-mute medium text-secondary mt-1">Okt</p>
        </div>
      </div>
      <div class="item-inner">
        <div class="item-title" style="font-weight: 500; font-size: 20px;">Kerjaan</div>
        <div class="item-after"><strong>07:30 - 16:45</strong></div>
      </div>
    </div>
  </li>
  <li>
    <div class="item-content">
      <div class="item-media">
        <div class="col text-align-center">
            <h6 class="font-weight-normal mb-0 mt-1" style="color: red;">10</h6>
            <p class="text-mute medium text-secondary mt-1" style="color: red;">Okt</p>
        </div>
      </div>
      <div class="item-inner">
        <div class="item-title" style="font-weight: 500;color: red; font-size: 20px;">Libur</div>
      </div>
    </div>
  </li>
  <li>
    <div class="item-content">
      <div class="item-media">
        <div class="col text-align-center">
            <h6 class="font-weight-normal mb-0 mt-1" style="color: red;">11</h6>
            <p class="text-mute medium text-secondary mt-1" style="color: red;">Okt</p>
        </div>
      </div>
      <div class="item-inner">
        <div class="item-title" style="font-weight: 500;color: red; font-size: 20px;">Libur</div>
      </div>
    </div>
  </li> -->